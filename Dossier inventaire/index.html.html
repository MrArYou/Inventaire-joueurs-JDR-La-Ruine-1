<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inventaire Multi-Grilles Style Resident Evil</title>
  <!-- Import de Roboto pour une touche contemporaine -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /*-------------------------------------------------------*
     *          Styles Généraux et Mise en Page             *
     *-------------------------------------------------------*/
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #1f1f1f, #2a2a2a);
      color: #eee;
      margin: 20px;
      padding: 0;
    }
    
    /* Conteneur principal en deux colonnes */
    #mainContainer {
      display: flex;
      gap: 20px;
    }
    
    /*-------------------------------------------------------*
     *                Zone Inventaire (Gauche)              *
     *-------------------------------------------------------*/
    #inventoryArea {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    /* Formulaires d'ajout */
    .form-section {
      text-align: center;
      margin-bottom: 10px;
    }
    .form-section input {
      margin: 5px;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #555;
      background: #333;
      color: #eee;
      outline: none;
    }
    .form-section button {
      padding: 6px 12px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #2ecc71;
      color: #fff;
      transition: background 0.3s ease;
    }
    .form-section button:hover {
      background: #27ae60;
    }
    
    /* Conteneur d'inventaires */
    #inventoryContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .inventory-wrapper {
      background: #2a2a2a;
      border: 1px solid #555;
      border-radius: 6px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5);
      width: max-content;
      transition: transform 0.2s ease;
    }
    .inventory-wrapper:hover {
      transform: scale(1.02);
    }
    
    /* En-tête de l'inventaire */
    .inventory-header {
      background-color: #444;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #555;
      cursor: pointer;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }
    .header-right {
      display: inline-flex;
      gap: 10px;
      align-items: center;
    }
    .inventory-title {
      font-size: 1.1em;
      font-weight: bold;
    }
    .inventory-weight-indicator {
      font-size: 0.9em;
    }
    .delete-inventory-button {
      background-color: #e74c3c;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 3px;
      font-size: 0.9em;
      transition: background 0.3s ease;
    }
    .delete-inventory-button:hover {
      background-color: #c0392b;
    }
    
    /* Grille de l'inventaire */
    .inventory {
      position: relative;
      display: grid;
      grid-gap: 4px;
      background-color: #3a3a3a;
      border: 1px dashed #555;
      padding: 6px;
    }
    .cell {
      width: 50px;
      height: 50px;
      border: 1px solid #666;
      background: #2a2a2a;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    /* Cellule marquée "hole" */
    .cell.hole {
      background: #555;
      opacity: 0.7;
    }
    
    /* Style des items dans l'inventaire */
    .item {
      position: absolute;
      background-color: #3498db;
      color: #fff;
      border-radius: 4px;
      cursor: move;
      z-index: 10;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    }
    
    /* Tooltip pour la description d'objet */
    #tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.85);
      color: #fff;
      padding: 5px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      display: none;
      z-index: 1000;
      pointer-events: none;
    }
    
    /*-------------------------------------------------------*
     *              Fiche Personnage (Droite)               *
     *-------------------------------------------------------*/
    #characterSheet {
      width: 250px;
      background: #303030;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    }
    
    /* Zone d'upload d'image pour le personnage */
    #characterImageContainer {
      width: 100%;
      height: 200px;
      border: 2px dashed #666;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      margin-bottom: 20px;
      transition: background 0.3s ease;
    }
    #characterImageContainer:hover {
      background: rgba(255,255,255,0.08);
    }
    #characterImageContainer img {
      max-width: 100%;
      max-height: 100%;
    }
    #characterFileInput {
      display: none;
    }
    
    /* Blocs de stats principaux */
    .stat-block {
      margin-bottom: 15px;
    }
    .stat-title {
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 4px;
    }
    .stat-bar {
      width: 100%;
      height: 10px;
      background: #444;
      border-radius: 5px;
      overflow: hidden;
    }
    .stat-fill {
      height: 100%;
      border-radius: 5px;
      transition: width 0.3s ease;
    }
    .health .stat-fill   { background: #ff4d4d; }
    .energy .stat-fill   { background: #ffe066; }
    .mental .stat-fill   { background: #4dd0e1; }
    .stat-control {
      display: flex;
      gap: 5px;
      align-items: center;
      margin-top: 6px;
    }
    .stat-control input {
      width: 50px;
      padding: 4px;
      text-align: center;
      border-radius: 4px;
      border: 1px solid #555;
      background: #333;
      color: #eee;
      outline: none;
    }
    .stat-control button {
      background: #2ecc71;
      border: none;
      padding: 4px 10px;
      cursor: pointer;
      border-radius: 4px;
      color: white;
      transition: background 0.3s ease;
    }
    .stat-control button:hover {
      background: #27ae60;
    }
    
    /* Tableau des Stats Personnage (6 lignes) */
    #characterStatsTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.9em;
    }
    #characterStatsTable th,
    #characterStatsTable td {
      border: 1px solid #555;
      padding: 4px;
      text-align: center;
    }
    #characterStatsTable input {
      background: #444;
      border: none;
      color: #eee;
      width: 100%;
      text-align: center;
      padding: 2px;
    }
    
    /* Zone Mission */
    #missionSection {
      margin-top: 10px;
    }
    #missionSection p {
      margin: 5px 0;
      font-size: 0.9em;
      color: #ccc;
    }
    #missionSection textarea {
      width: 100%;
      height: 60px;
      border: 1px solid #555;
      border-radius: 4px;
      background: #444;
      color: #eee;
      padding: 4px;
      resize: vertical;
    }
    
    /* Section Compétences */
    #competencesSection {
      margin-top: 15px;
    }
    #competencesSection h3 {
      font-size: 1em;
      margin-bottom: 5px;
    }
    #competencesTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
    }
    #competencesTable th,
    #competencesTable td {
      border: 1px solid #555;
      padding: 4px;
      text-align: center;
    }
    #competencesTable input {
      background: #444;
      border: none;
      color: #eee;
      width: 100%;
      text-align: center;
      padding: 2px;
    }
    #addCompetenceButton {
      margin-top: 5px;
      padding: 4px 8px;
      border: none;
      border-radius: 4px;
      background: #2ecc71;
      color: white;
      font-size: 0.9em;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    #addCompetenceButton:hover {
      background: #27ae60;
    }
    
    /* Séparateur Sanglant */
    .blood-separator {
      width: 5px;
      background: url('blood-texture.png') center no-repeat;
      background-size: cover;
      background-color: darkred;
    }
  </style>
</head>
<body>
  <div id="mainContainer">
    <!-- Partie Inventaire (Gauche) -->
    <div id="inventoryArea">
      <!-- Formulaire d'ajout d'inventaire -->
      <div class="form-section" id="inventoryForm">
        <input type="text" id="newInventoryName" placeholder="Nom de l'inventaire">
        <input type="number" id="newInventoryCols" placeholder="Colonnes (ex. 6)" value="6">
        <input type="number" id="newInventoryRows" placeholder="Rangs (ex. 8)" value="8">
        <input type="number" id="newInventoryMaxWeight" placeholder="Capacité du sac (ex. 1000)" value="1000">
        <button onclick="addInventory()">Ajouter inventaire</button>
      </div>
      
      <!-- Formulaire d'ajout d'objet -->
      <div class="form-section" id="itemForm">
        <input type="text" id="itemName" placeholder="Nom de l'objet">
        <input type="number" id="itemW" placeholder="Largeur (cases)">
        <input type="number" id="itemH" placeholder="Hauteur (cases)">
        <input type="text" id="itemDesc" placeholder="Description">
        <input type="number" id="itemPockets" placeholder="Poches">
        <input type="number" id="itemWeight" placeholder="Poids">
        <button onclick="addItemToCurrentInventory()">Ajouter l'objet</button>
      </div>
      
      <!-- Container pour les inventaires -->
      <div id="inventoryContainer"></div>
    </div>
    
    <!-- Séparateur Sanglant -->
    <div class="blood-separator"></div>
    
    <!-- Fiche Personnage (Droite) -->
    <div id="characterSheet">
      <!-- Zone d'upload d'image pour le personnage -->
      <div id="characterImageContainer">
        <span id="characterImageLabel" style="color: #aaa;">Glissez ou cliquez pour uploader</span>
        <img id="characterImage" src="avatar.png" alt="Votre image">
        <input type="file" id="characterFileInput" accept="image/*">
      </div>
      <!-- Blocs de stats principaux -->
      <div class="stat-block health">
        <div class="stat-title">Vie</div>
        <div class="stat-bar">
          <div class="stat-fill" style="width: 80%;"></div>
        </div>
        <div class="stat-control">
          <button onclick="adjustStat('health', -10)">-</button>
          <input id="healthValue" type="number" value="80">
          <button onclick="adjustStat('health', 10)">+</button>
        </div>
      </div>
      <div class="stat-block energy">
        <div class="stat-title">Énergie</div>
        <div class="stat-bar">
          <div class="stat-fill" style="width: 60%;"></div>
        </div>
        <div class="stat-control">
          <button onclick="adjustStat('energy', -10)">-</button>
          <input id="energyValue" type="number" value="60">
          <button onclick="adjustStat('energy', 10)">+</button>
        </div>
      </div>
      <div class="stat-block mental">
        <div class="stat-title">Mental</div>
        <div class="stat-bar">
          <div class="stat-fill" style="width: 90%;"></div>
        </div>
        <div class="stat-control">
          <button onclick="adjustStat('mental', -10)">-</button>
          <input id="mentalValue" type="number" value="90">
          <button onclick="adjustStat('mental', 10)">+</button>
        </div>
      </div>
      <!-- Sous-partie : Tableau des Stats Personnage (6 lignes) -->
      <div id="additionalStats">
        <h3 style="font-size: 1em; margin-bottom: 5px;">Stats Personnage</h3>
        <table id="characterStatsTable">
          <thead>
            <tr>
              <th>Stats</th>
              <th>Valeur</th>
              <th>Observation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" placeholder="Stat"></td>
              <td><input type="text" placeholder="Valeur"></td>
              <td><input type="text" placeholder="Observation"></td>
            </tr>
            <tr>
              <td><input type="text" placeholder="Stat"></td>
              <td><input type="text" placeholder="Valeur"></td>
              <td><input type="text" placeholder="Observation"></td>
            </tr>
            <tr>
              <td><input type="text" placeholder="Stat"></td>
              <td><input type="text" placeholder="Valeur"></td>
              <td><input type="text" placeholder="Observation"></td>
            </tr>
            <tr>
              <td><input type="text" placeholder="Stat"></td>
              <td><input type="text" placeholder="Valeur"></td>
              <td><input type="text" placeholder="Observation"></td>
            </tr>
            <tr>
              <td><input type="text" placeholder="Stat"></td>
              <td><input type="text" placeholder="Valeur"></td>
              <td><input type="text" placeholder="Observation"></td>
            </tr>
            <tr>
              <td><input type="text" placeholder="Stat"></td>
              <td><input type="text" placeholder="Valeur"></td>
              <td><input type="text" placeholder="Observation"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Zone "Votre mission" en dehors du tableau -->
      <div id="missionSection">
        <p style="font-size: 0.9em;">Votre mission :</p>
        <textarea id="missionText" placeholder="Décrivez votre mission" style="width: 100%; height: 60px; border: 1px solid #555; border-radius: 4px; background: #444; color: #eee; padding: 4px;"></textarea>
      </div>
      <!-- Sous-partie : Compétences -->
      <div id="competencesSection">
        <h3 style="font-size: 1em; margin-bottom: 5px;">Compétences</h3>
        <table id="competencesTable">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" placeholder="Nom"></td>
              <td><input type="text" placeholder="Description"></td>
            </tr>
          </tbody>
        </table>
        <button id="addCompetenceButton" onclick="addCompetence()">Ajouter une compétence</button>
      </div>
    </div>
  </div>
  
  <!-- Tooltip pour la description des objets -->
  <div id="tooltip"></div>
  
  <script>
    /*-------------------------*
     * Gestion des Statistiques *
     *-------------------------*/
    function adjustStat(stat, change) {
      const statValue = document.getElementById(stat + 'Value');
      let newValue = parseInt(statValue.value) + change;
      if (newValue < 0) newValue = 0;
      if (newValue > 100) newValue = 100;
      statValue.value = newValue;
      document.querySelector('.' + stat + ' .stat-fill').style.width = newValue + '%';
    }
    
    /*---------------------------*
     *    Gestion de l'Inventaire *
     *---------------------------*/
    const LOCAL_STORAGE_KEY = 'inventoriesData';
    let inventoriesData = [];
    let currentInventory = null;
    let draggingElement = null;
    const inventoryContainer = document.getElementById('inventoryContainer');
    const tooltip = document.getElementById('tooltip');
    
    // Sauvegarder les données dans le localStorage
    function saveInventoryData() {
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(inventoriesData));
    }
    
    // Charger les données depuis le localStorage
    function loadInventoryData() {
      const data = localStorage.getItem(LOCAL_STORAGE_KEY);
      if (data) {
        inventoriesData = JSON.parse(data);
        inventoriesData.forEach(data => createInventory(data));
      }
    }
    
    // Mise à jour de l'indicateur de poids
    function updateInventoryWeight(inventoryData, inventoryDiv, weightIndicator) {
      const totalWeight = inventoryData.items.reduce((sum, item) => sum + (item.weight || 0), 0);
      weightIndicator.textContent = `Poids: ${totalWeight} / ${inventoryData.maxWeight}`;
      let newColor = "white";
      if (totalWeight < inventoryData.maxWeight) {
        newColor = "white";
      } else if (totalWeight < inventoryData.maxWeight * 1.25) {
        newColor = "orange";
      } else if (totalWeight < inventoryData.maxWeight * 1.5) {
        newColor = "red";
      } else {
        newColor = "darkred";
      }
      weightIndicator.style.color = newColor;
      inventoryDiv.style.borderColor = newColor;
    }
    
    // Création d'un inventaire (sac)
    function createInventory(data) {
      const inventoryWrapper = document.createElement('div');
      inventoryWrapper.classList.add('inventory-wrapper');
      
      // En-tête de l'inventaire
      const header = document.createElement('div');
      header.classList.add('inventory-header');
      
      const title = document.createElement('span');
      title.classList.add('inventory-title');
      title.textContent = data.name;
      header.appendChild(title);
      
      const headerRight = document.createElement('div');
      headerRight.classList.add('header-right');
      
      const weightIndicator = document.createElement('span');
      weightIndicator.classList.add('inventory-weight-indicator');
      headerRight.appendChild(weightIndicator);
      
      const deleteButton = document.createElement('button');
      deleteButton.classList.add('delete-inventory-button');
      deleteButton.textContent = 'Supprimer';
      deleteButton.addEventListener('click', (e) => {
        e.stopPropagation();
        if (confirm("Voulez-vous vraiment supprimer cet inventaire ?")) {
          inventoriesData = inventoriesData.filter(inv => inv.id !== data.id);
          saveInventoryData();
          inventoryWrapper.remove();
          if (currentInventory && currentInventory.id === data.id) {
            currentInventory = null;
          }
        }
      });
      headerRight.appendChild(deleteButton);
      header.appendChild(headerRight);
      
      header.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        if (confirm("Voulez-vous vraiment supprimer cet inventaire ?")) {
          inventoriesData = inventoriesData.filter(inv => inv.id !== data.id);
          saveInventoryData();
          inventoryWrapper.remove();
          if (currentInventory && currentInventory.id === data.id) {
            currentInventory = null;
          }
        }
      });
      
      inventoryWrapper.appendChild(header);
      
      // Création de la grille (le sac)
      const inventoryDiv = document.createElement('div');
      inventoryDiv.classList.add('inventory');
      inventoryDiv.id = data.id;
      inventoryDiv.style.gridTemplateColumns = `repeat(${data.cols}, 50px)`;
      inventoryDiv.style.gridTemplateRows = `repeat(${data.rows}, 50px)`;
      inventoryDiv.style.position = 'relative';
      inventoryDiv.style.width = (data.cols * 52) + 'px';
      inventoryDiv.style.height = (data.rows * 52) + 'px';
      inventoryWrapper.appendChild(inventoryDiv);
      
      // Création des cellules
      for (let i = 0; i < data.cols * data.rows; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.index = i;
        if (data.holes && data.holes.includes(i)) {
          cell.classList.add('hole');
        }
        // Bascule "hole" lors du clic
        cell.addEventListener('click', function() {
          cell.classList.toggle('hole');
          if (!data.holes) { data.holes = []; }
          if (cell.classList.contains('hole')) {
            if (!data.holes.includes(i)) { data.holes.push(i); }
          } else {
            data.holes = data.holes.filter(idx => idx !== i);
          }
          saveInventoryData();
        });
        inventoryDiv.appendChild(cell);
      }
      
      // Placement des items existants
      data.items.forEach(item => placeItem(inventoryDiv, item));
      updateInventoryWeight(data, inventoryDiv, weightIndicator);
      
      // Gestion du drag & drop sur la grille
      inventoryDiv.addEventListener('dragover', (e) => {
        e.preventDefault();
      });
      
      inventoryDiv.addEventListener('drop', (e) => {
        e.preventDefault();
        const itemData = JSON.parse(e.dataTransfer.getData('text/plain'));
        const rect = inventoryDiv.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) / 52);
        const y = Math.floor((e.clientY - rect.top) / 52);
        
        // Vérification des limites
        if (x < 0 || y < 0 || x + itemData.w > data.cols || y + itemData.h > data.rows) {
          alert("Impossible de déposer l'objet en dehors de l'inventaire.");
          return;
        }
        
        // Vérification des cellules "hole"
        let valid = true;
        for (let j = y; j < y + itemData.h; j++) {
          for (let i = x; i < x + itemData.w; i++) {
            const cellIndex = j * data.cols + i;
            const cell = inventoryDiv.querySelector('.cell[data-index="'+ cellIndex +'"]');
            if (cell && cell.classList.contains('hole')) {
              valid = false;
              break;
            }
          }
          if (!valid) break;
        }
        if (!valid) {
          alert("Vous ne pouvez pas déposer un objet sur une case grisée !");
          return;
        }
        
        // Mise à jour des coordonnées
        itemData.x = x;
        itemData.y = y;
        
        // Gestion du transfert entre inventaires
        if (itemData.inventoryId !== data.id) {
          const oldInventory = inventoriesData.find(inv => inv.id === itemData.inventoryId);
          if (oldInventory) {
            oldInventory.items = oldInventory.items.filter(i => i.id !== itemData.id);
            const oldInvDiv = document.getElementById(oldInventory.id);
            if (oldInvDiv) {
              const oldWeightIndicator = oldInvDiv.parentElement.querySelector('.inventory-weight-indicator');
              updateInventoryWeight(oldInventory, oldInvDiv, oldWeightIndicator);
              const oldItemElem = document.getElementById(itemData.id);
              if (oldItemElem) { oldItemElem.remove(); }
            }
          }
          itemData.inventoryId = data.id;
          const newInventory = inventoriesData.find(inv => inv.id === data.id);
          if (newInventory) { newInventory.items.push(itemData); }
          let existingElem = document.getElementById(itemData.id);
          if (existingElem) { existingElem.remove(); }
          placeItem(inventoryDiv, itemData);
          const newWeightIndicator = inventoryDiv.parentElement.querySelector('.inventory-weight-indicator');
          updateInventoryWeight(newInventory, inventoryDiv, newWeightIndicator);
          saveInventoryData();
          return;
        }
        
        // Même inventaire : mise à jour de la position dans le DOM
        const itemElem = document.getElementById(itemData.id);
        if (itemElem) {
          itemElem.style.left = (x * 52) + 'px';
          itemElem.style.top = (y * 52) + 'px';
        }
        saveInventoryData();
      });
      
      inventoryContainer.appendChild(inventoryWrapper);
    }
    
    // Fonction pour placer un item dans la grille
    function placeItem(inventoryDiv, item) {
      const itemElem = document.createElement('div');
      itemElem.classList.add('item');
      itemElem.id = item.id;
      itemElem.textContent = item.name;
      itemElem.style.width = (item.w * 50 + (item.w - 1) * 2) + 'px';
      itemElem.style.height = (item.h * 50 + (item.h - 1) * 2) + 'px';
      itemElem.style.left = (item.x * 52) + 'px';
      itemElem.style.top = (item.y * 52) + 'px';
      itemElem.setAttribute('draggable', 'true');
      
      // Drag & drop sur l'item
      itemElem.addEventListener('dragstart', (e) => {
        draggingElement = itemElem;
        e.dataTransfer.setData('text/plain', JSON.stringify(item));
      });
      
      // Double-clic pour rotation de 90°
      itemElem.addEventListener('dblclick', (e) => {
        e.stopPropagation();
        item.rotation = (item.rotation || 0) + 90;
        itemElem.style.transform = 'rotate(' + item.rotation + 'deg)';
        const inv = inventoriesData.find(inv => inv.id === inventoryDiv.id);
        if (inv) {
          const found = inv.items.find(i => i.id === item.id);
          if (found) {
            found.rotation = item.rotation;
            saveInventoryData();
          }
        }
      });
      
      // Clic droit pour supprimer l'objet
      itemElem.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        if (confirm("Voulez-vous vraiment supprimer cet objet ?")) {
          itemElem.remove();
          const inv = inventoriesData.find(inv => inv.id === inventoryDiv.id);
          if (inv) {
            inv.items = inv.items.filter(i => i.id !== item.id);
            saveInventoryData();
          }
        }
      });
      
      // Affichage de la tooltip (description)
      itemElem.addEventListener('mouseover', (e) => {
        tooltip.textContent = item.desc || '';
        tooltip.style.display = 'block';
      });
      itemElem.addEventListener('mousemove', (e) => {
        tooltip.style.left = e.pageX + 10 + 'px';
        tooltip.style.top = e.pageY + 10 + 'px';
      });
      itemElem.addEventListener('mouseout', (e) => {
        tooltip.style.display = 'none';
      });
      
      inventoryDiv.appendChild(itemElem);
    }
    
    // Fonction pour ajouter un inventaire
    function addInventory() {
      const name = document.getElementById('newInventoryName').value;
      const cols = parseInt(document.getElementById('newInventoryCols').value);
      const rows = parseInt(document.getElementById('newInventoryRows').value);
      const maxWeight = parseInt(document.getElementById('newInventoryMaxWeight').value);
      const newInventory = {
        id: 'inv-' + Date.now(),
        name: name || 'Inventaire',
        cols: cols,
        rows: rows,
        maxWeight: maxWeight,
        items: [],
        holes: []
      };
      inventoriesData.push(newInventory);
      saveInventoryData();
      createInventory(newInventory);
      currentInventory = newInventory;
    }
    
    // Fonction pour ajouter un objet à l'inventaire sélectionné
    function addItemToCurrentInventory() {
      if (!currentInventory) {
        alert("Veuillez sélectionner un inventaire.");
        return;
      }
      const name = document.getElementById('itemName').value;
      const w = parseInt(document.getElementById('itemW').value);
      const h = parseInt(document.getElementById('itemH').value);
      const desc = document.getElementById('itemDesc').value;
      const pockets = parseInt(document.getElementById('itemPockets').value);
      const weight = parseInt(document.getElementById('itemWeight').value);
      const newItem = {
        id: 'item-' + Date.now(),
        name: name,
        w: w,
        h: h,
        desc: desc,
        pockets: pockets,
        weight: weight,
        x: 0,
        y: 0,
        inventoryId: currentInventory.id
      };
      currentInventory.items.push(newItem);
      saveInventoryData();
      const invDiv = document.getElementById(currentInventory.id);
      placeItem(invDiv, newItem);
      const weightIndicator = invDiv.parentElement.querySelector('.inventory-weight-indicator');
      updateInventoryWeight(currentInventory, invDiv, weightIndicator);
    }
    
    // Fonction pour ajouter une compétence (une nouvelle ligne dans le tableau des compétences)
    function addCompetence() {
      const tbody = document.getElementById("competencesTable").getElementsByTagName("tbody")[0];
      const row = tbody.insertRow();
      const cell1 = row.insertCell(0);
      const cell2 = row.insertCell(1);
      cell1.innerHTML = '<input type="text" placeholder="Nom">';
      cell2.innerHTML = '<input type="text" placeholder="Description">';
    }
    
    // Chargement initial des inventaires
    loadInventoryData();
    
    /*------------------------------------------------*
     * Gestion de l'upload d'image pour le personnage *
     *------------------------------------------------*/
    const characterImageContainer = document.getElementById("characterImageContainer");
    const characterImageLabel = document.getElementById("characterImageLabel");
    const characterImage = document.getElementById("characterImage");
    const characterFileInput = document.getElementById("characterFileInput");
    
    // Ouvrir le sélecteur de fichiers au clic
    characterImageContainer.addEventListener("click", () => {
      characterFileInput.click();
    });
    
    // Lorsque l'image est sélectionnée
    characterFileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          characterImage.src = ev.target.result;
          characterImage.style.display = "block";
          characterImageLabel.style.display = "none";
        }
        reader.readAsDataURL(file);
      }
    });
    
    // Gestion du glisser-déposer sur la zone d'image
    characterImageContainer.addEventListener("dragover", (e) => {
      e.preventDefault();
    });
    characterImageContainer.addEventListener("drop", (e) => {
      e.preventDefault();
      const dt = e.dataTransfer;
      if (dt.files && dt.files.length > 0) {
        const file = dt.files[0];
        if (file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = function(ev) {
            characterImage.src = ev.target.result;
            characterImage.style.display = "block";
            characterImageLabel.style.display = "none";
          }
          reader.readAsDataURL(file);
        } else {
          alert("Veuillez déposer un fichier image.");
        }
      }
    });
  </script>
</body>
</html>
